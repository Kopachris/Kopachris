# coding: utf8

from gluon.scheduler import Scheduler
import os

def check_bot():
    # check status of bot, restart if
    # not running and not explicity stopped
    import bot_utils
    bot_pid = int(bot_utils.get_item('pid', db))
    try:
        if not bot_pid:
            #bot quit via web interface
            return
        elif os.getpgid(bot_pid):
            #bot still running
            return
    except OSError:
        #os.getpgid() failed - no process with that pid
        #bot dead, but not quit properly
        os.system('python web2py.py -S bot -M -R applications/bot/private/bot_run.py')


#sched = Scheduler(db)
#sched.queue_task(check_bot, repeats=0, period=180, timeout=30)
